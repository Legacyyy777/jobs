# –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞** –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `db.init_tables()`.

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `IF NOT EXISTS` / `IF EXISTS` - –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ **–ù–ï –∏–∑–º–µ–Ω—è—é—Ç—Å—è**
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã **–ù–ï –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è**
- –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

## –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

### –ú–∏–≥—Ä–∞—Ü–∏—è 1: –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–î–∞—Ç–∞:** –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `profession` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
- –¢–∏–ø: `VARCHAR(20)` 
- –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `'painter'`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏: `profession = 'painter'`

**SQL:**
```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS profession VARCHAR(20) DEFAULT 'painter';
UPDATE users SET profession = 'painter' WHERE profession IS NULL;
```

---

### –ú–∏–≥—Ä–∞—Ü–∏—è 2: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Å–∫–æ—Å—Ç—Ä—É–π—â–∏–∫–æ–≤ –∏ —Å—É–ø–æ—Ä—Ç–æ–≤
**–î–∞—Ç–∞:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–µ—Å–∫–æ—Å—Ç—Ä—É–π—â–∏–∫–æ–≤

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ `orders`:**
- `suspensia_type VARCHAR(20)` - —Ç–∏–ø —Å—É–ø–æ—Ä—Ç–æ–≤ (paint/logo)
- `quantity INTEGER DEFAULT 1` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É–ø–æ—Ä—Ç–æ–≤
- `spraying_deep INTEGER DEFAULT 0` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–ª—É–±–æ–∫–∏—Ö –Ω–∞–ø—ã–ª–µ–Ω–∏–π
- `spraying_shallow INTEGER DEFAULT 0` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–≥–ª—É–±–æ–∫–∏—Ö –Ω–∞–ø—ã–ª–µ–Ω–∏–π
- –ö–æ–ª–æ–Ω–∫–∞ `size` —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –±—ã—Ç—å NULL (–¥–ª—è —Å—É–ø–æ—Ä—Ç–æ–≤ –∏ –Ω–∞—Å–∞–¥–æ–∫)

**SQL:**
```sql
ALTER TABLE orders ADD COLUMN IF NOT EXISTS suspensia_type VARCHAR(20);
ALTER TABLE orders ADD COLUMN IF NOT EXISTS quantity INTEGER DEFAULT 1;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS spraying_deep INTEGER DEFAULT 0;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS spraying_shallow INTEGER DEFAULT 0;
ALTER TABLE orders ALTER COLUMN size DROP NOT NULL;
```

---

### –ú–∏–≥—Ä–∞—Ü–∏—è 3: –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
**–î–∞—Ç–∞:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ `orders`:**
- `reminder_sent BOOLEAN DEFAULT FALSE` - —Ñ–ª–∞–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- `reminder_message_id BIGINT` - ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

**SQL:**
```sql
ALTER TABLE orders ADD COLUMN IF NOT EXISTS reminder_sent BOOLEAN DEFAULT FALSE;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS reminder_message_id BIGINT;
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç
- –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

---

### –ú–∏–≥—Ä–∞—Ü–∏—è 4: –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –ø–æ–ª–µ–π
**–î–∞—Ç–∞:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–¥–∞–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `profession` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `orders` (–¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∞—Å—å –∏–∑ `users`)
- –£–¥–∞–ª–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ `orders_order_number_key`
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–æ–º–µ—Ä–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏

**SQL:**
```sql
ALTER TABLE orders DROP COLUMN IF EXISTS profession;
ALTER TABLE orders DROP CONSTRAINT IF EXISTS orders_order_number_key;
```

---

## –ò–Ω–¥–µ–∫—Å—ã

–î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:

```sql
CREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);
CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(status);
CREATE INDEX IF NOT EXISTS idx_orders_created_at ON orders(created_at);
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:

```
üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ profession –≤ —Ç–∞–±–ª–∏—Ü—É users
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –ø–µ—Å–∫–æ—Å—Ç—Ä—É–π—â–∏–∫–∞ –∏ —Å—É–ø–æ—Ä—Ç–æ–≤
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
```

---

## –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö!

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:

```sql
-- –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ 3 (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)
ALTER TABLE orders DROP COLUMN IF EXISTS reminder_sent;
ALTER TABLE orders DROP COLUMN IF EXISTS reminder_message_id;

-- –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ 2 (–ø–µ—Å–∫–æ—Å—Ç—Ä—É–π—â–∏–∫–∏)
ALTER TABLE orders DROP COLUMN IF EXISTS suspensia_type;
ALTER TABLE orders DROP COLUMN IF EXISTS quantity;
ALTER TABLE orders DROP COLUMN IF EXISTS spraying_deep;
ALTER TABLE orders DROP COLUMN IF EXISTS spraying_shallow;

-- –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ 1 (–ø—Ä–æ—Ñ–µ—Å—Å–∏–∏)
ALTER TABLE users DROP COLUMN IF EXISTS profession;
```

---

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ PostgreSQL 12+
- ‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ)
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ù–µ—Ç downtime –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

